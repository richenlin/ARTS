# 云架构师认证

## 架构设计原则

### 高可用

采用合理的成本来选择和组合云产品，以满足业务需求的同时，提高系统可用性，可扩展性以及安全性

可用性： 计算机系统能够持续无故障正常运行的概率。在互联网业务里面，一般指平均能够正常的为用户提供服务的概率

```
MTTF = (MTTF + MTTR) * 100%
```

| 级别         |      | 可用性  | 故障时长 |
| ------------ | ---- | ------- | -------- |
| 基本可用性   | 2个9 | 99%     | 87.6小时 |
| 较高可用性   | 3个9 | 99.9%   | 8.8小时  |
| 故障自动恢复 | 4个9 | 99.99%  | 53分钟   |
| 极高可用性   | 5个9 | 99.999% | 5分钟    |

#### 设计原则

围绕着如何提高可用性，通过评估分级、冗余设计以及伸缩性来提升MTTF，降低MTTR

##### 评估分级

国际上对于灾难恢复能力及业务恢复能力的指标：

|          | 容灾登记 | RTO        | RPO        |
| -------- | -------- | ---------- | ---------- |
| 初期目标 | 1级      | >=2天      | 1~7天      |
|          | 2级      | >=24小时   | 1~7天      |
|          | 3级      | >=12小时   | 1~7天      |
|          | 4级      | 几分钟~2天 | 几小时~1天 |
| 最终目标 | 5级      | 几分钟~2天 | 0~30分钟   |
|          | 6级      | 几分钟     | 0          |

评估分级需求：

* 时间段内可用性时间要求，含计划与非计划停机时间
* 业务量指标及响应时间要求
* 特殊时间段可用性要求

##### 冗余设计

从网络、存储、计算三个方面考虑，将单节点单通道进化为多节点多通道

常见的模式：

* 主从模式（数据库）
* 双机双工
* 集群模式

##### 伸缩性

纵向扩展： 增加对应的配置

横向扩展：增加对应的实例

#### 腾讯云高可用服务

* 硬件支持    腾讯云机房遍布全球，实现了完备的容灾策略，选用高质量的IDC机房实现多运营商接入，高标准的机房网络建设
* 平台支持    虚拟化技术，数据冗余存储，数据中心内实例自动故障迁移
* 高可用组件  腾讯云提供双机热备（如数据库、NAT网关）、分布式（如SCF、云缓存）等高可用设计

| 类型      | 产品                                                         |
| --------- | ------------------------------------------------------------ |
| 存储      | 对象存储、文件存储、归档存储、云硬盘                         |
| 数据库    | 关系型数据库、弹性缓存、HTAP数据库、时序数据库、分布式数据库、列式数据库 |
| 网络      | NAT网关、云解析                                              |
| 中间件    | 负载均衡、消息队列、API网关、分布式服务框架                  |
| CDN与加速 | 静态内容加速、动态加速网络、下载分发加速、视音频点播加速     |

* 高可用架构   两地三中心、负载均衡、弹性伸缩

### 高扩展

扩展性是指业务IT系统，应对业务变更和功能变化时，调整的难易程度，用来保障系统适应调整的能力。这里的扩展性指系统扩展性，并非指代码的扩展性。

系统扩展性高：

* 修改模块功能，不对其他模块产生影响
* 新增或减少功能模块，不对原有架构体系产生冲击
* 业务变更与上线，开发团队轻松应对

#### 设计原则

* 使用标准的云组件
* 微服务化

方向：

* 使用消息队列异步化改造
  * 梳理业务逻辑的关键路径，拆离非关键逻辑
  * 将分布式事务异步化处理
  * 利用消息队列的存储转发功能
  * 使用消息队列的订阅功能
* 减少自建的通用型服务
  * 腾讯云服务集群化及扩缩容能力
  * 腾讯云服务是标准化和高度抽象的，不会涉及具体的业务逻辑
  * 腾讯云服务提供标准化的接口，降低数据依赖，提高扩展性
* 计算和数据分离
  * Session、token等应存放在高速缓存组件中，不应存放在计算服务器中
  * 计算与数据分离，才能避免数据耦合，支持计算能力的弹性伸缩

### 高安全

目的：

* 业务连续性和安全性
* 数据不丢失
* 数据不泄露

包含主机安全、网络安全、数据安全、应用安全、业务安全

#### 主机安全

风险：

* 木马攻击
* 密码破解
* 漏洞攻击

策略：

* 制定合理的补丁更新策略
* 定期漏洞扫描
* 安装安全防护软件
* 关闭或过滤高危端口

#### 网络安全

风险：

* DDos攻击
* XSS攻击
* 注入攻击
* CC攻击
* CSRF攻击

策略：

* 流量清洗
* 定期漏洞扫描
* 网络隔离，防止损失扩大

#### 数据安全

风险：

* 数据泄露   因员工疏忽或系统故障
* 数据窃取   嗅探攻击、中间人攻击

策略：

* 按最低权限原则分配访问和操作权限
* 进行数据加密

#### 业务和应用安全

风险：

* 羊毛党
* 金融欺诈
* 应用漏洞

策略：

* 设计防刷策略
* 借助腾讯云产品识别用户画像
* 加强应用防护，修复漏洞

#### 腾讯云高安全服务

| 安全类别 | 安全产品/服务                                           |
| -------- | ------------------------------------------------------- |
| 网络安全 | VPC、安全组、大禹、网站管家WAF                          |
| 业务安全 | 天御（活动防刷AA）                                      |
| 应用安全 | 应用安全MS                                              |
| 主机安全 | 云镜                                                    |
| 数据安全 | 密钥管理服务KMS、数据加密服务HSM、访问管理CAM、云审计CA |

### 低成本

#### 上云减少资源投入

* 人员成本： 管理、开发、运维
* 基础设施成本：数据中心、硬件、网络
* 时间成本：IDC选址、基础服务商选择、商务、设备调测、试运行

#### 降低成本的方式

* 降低基础设施成本：按需购买、弹性伸缩、用完释放
* 降低开发成本：分布式服务框架、无服务器函数、腾讯云PAAS平台
* 降低运维成本：云监控、蓝鲸一站式运维
* 选择合适的腾讯云付费方案：包年包月、按量付费、免费基础版

腾讯云PAAS： 数据库、应用平台、专有的应用处理

腾讯云IAAS：计算、网络、存储

## 合理的架构设计

### 避免单点

单一节点，一旦出现问题导致整个系统不可用

* 使用LB负载均衡和横向扩展集群
* 使用跨地域复制、灾备

### 实现可伸缩性

* 网络可伸缩：访问地区、网络地址、网络带宽
* 计算能力可伸缩：负载均衡+弹性计算、无服务器函数
* 存储可伸缩：容量可伸缩、自动数据分片

### 实现可扩展性

可扩展性指对系统影响最小的情况下，系统功能可持续扩展或能力提升

* 统一的接口和访问地址
* 业务系统组件解耦
* 使用通信中间件连接系统间组件
* 高可用、高扩展

系统扩展性的演进：

* 单体应用
* 垂直扩展：单体扩展为多个单体
* 面向服务式架构SOA： 集成多个较大组件（一般是应用），整体构成彼此协作的套件，通过特定的协议和接口进行交互
* 微服务架构：强调组件的独立性，拆分粒度更小；组件间从UI、控制层、逻辑层、数据库完全独立
* 服务网格架构：sidecar模式，将组件交互和通信的部分从微服务中独立出来，业务微服务不关心组件间通讯和交互，一般使用RPC调用

腾讯分布式服务框架TSF

腾讯云的容器服务TKE：基于原生kubernetes提供以容器为核心、高度可扩展的高性能容器管理服务

### 不要忽视安全

* 开源组件漏洞
* 网络安全
* 主机安全
* 数据安全
* 应用安全
* 业务安全

### 服务加速

* 跨地域的访问CDN节点加速
* DSA多地域发布IP

### 用完释放

* 按调用计费
* 按量计费
* 用完释放，设定释放条件

## 设计腾讯云基础架构

### 地域的概念

地域的概念：腾讯云服务器托管机房分布在全球多个位置，这些位置都由地域和可用区构成。每个地域都是一个独立的地理区域

地域的特性：

* 腾讯云地域覆盖全球，并仍在逐渐增加
* 不同地域完全隔离
* 选择最近地域，可降低访问时延
* 腾讯云设置有特别的金融专区

金融专区：主要针对金融行业监管要求定制的合规专区，一般提供给有监管审计需求的金融机构使用

* 高规格机房和隔离性
* 合规性
* 提供多种云服务
* 高规格安全服务
* 专区运维服务

腾讯云上不同资源是区分地域的，有些资源是全球唯一（用户账号），有些资源是全地域可用（SSH密钥），有些资源只能在单个地域使用（CVM实例、自定义镜像、弹性IP、安全组、云硬盘、快照、负载均衡、私有网络、子网、路由表）

### 地域的选择

* 选择最靠近客户的地域
* 尽量将产品放在一个地域
* 同一个地域内网互通

是否应该选择多个地域：

* 业务分布的地理位置距离远，例如电商的全球化访问、集团型企业的分布式文件系统
* 异地容灾，例如金融行业的两地三中心

### 可用区的概念

可用区是指腾讯云在同一地域内电力和网络互相独立的物理数据中心

特性：

* 同一地域下有多个可用区，并通过低时延的内网链路相连
* 腾讯云可用区随地域而全球分布，并逐渐增加
* 可用区的作用是故障隔离
* 启动实例时，可以选择指定地域下的任意可用区
* 用户可以讲实例迁移到其他可用区

腾讯云上的资源不但区分地域，还区分可用区。全地域全可用区（SSH密钥）、单地域单可用区（CVM实例、云硬盘、子网）、单地域多可用区（自定义镜像、弹性IP、安全组、快照、负载均衡、私有网络、路由表）

是否应该选择多个可用区：

* 高可用和容灾。金融行业的应用系统同城灾备、中大型企业的系统高可用

### 多地域部署策略

多地域部署既要考虑地域的选择，又要考虑可用区的选择

* 同地域不同可用区内网互通
* 不同地域云产品默认内网不互通（可以通过对等连接来互通）
* 负载均衡默认只能绑定本地域云服务器
* 地域之间可以通过公网IP或对等连接或云联网互访
* 不同云账号的资源内网完全隔离

