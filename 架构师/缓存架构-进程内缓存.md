# 缓存架构-进程内缓存

除了常见的redis/memcache等缓存服务之外，缓存还有一种常见的形态，那就是进程内缓存

> Q：什么是进程内缓存? 
> 
> A：顾名思义，将数据缓存在进程内存中，这就是进程内缓存

进程内缓存最简单的实现，就是一个带锁的Map。

> Q：进程内缓存能存储什么数据？
> 
> A：原则上常用的数据结构，都可以放入进程内缓存。甚至可以直接存放对象实例。

基本的数据结构，例如字符串、数值等，可以直接key/value存储。复杂的数据结构，比如队列，可以实现栈进行模拟。

> Q：进程内缓存的好处有哪些？
> 
> A：与没有缓存比，进程内缓存的好处是不再需要下游（例如数据库或依赖的服务）提供数据，数据直接可以读取；与进程外缓存（redis/memcache）相比，省去了网络开销，响应时延会更低
> 

虽然进程内缓存的优点很明显，但是缺点也很明显：

* 进程内缓存，要保证数据准确性，需要使用加锁等手段来实现原子操作，对性能有一定影响
* 进程内缓存，一般不会做持久化，在服务重启后会丢失。服务需要考虑容错恢复，降低依赖
* 进程内缓存，一但在分布式场景很难保证数据一致性。
* 进程内缓存违背了分层架构设计中，应用无状态设计的原则

> Q：那么我们有哪些方法保证分布式场景下的进程内缓存数据一致性？
> 

* 通过发布订阅模型，单节点数据变化的时候通知其他节点变更。存在的问题是集群多个节点耦合，网络连接关系复杂
* 使用MQ解耦，通过消息队列来异步更改。这个方案的问题是数据不实时，且引入了消息队列，增加了系统复杂性

> Q：什么时候可以使用进程内缓存？
> 


* 数据只读，可以在服务启动的时候加载。例如项目配置
* 需要极高并发的场景，透传后端压力较大，可以考虑实行。
* 一定程度上允许数据不一致（AC模型）的场景，例如运营类统计数据



